<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Marketplace Assistant - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE_URL = 'https://zq3oc7n5e8.execute-api.us-east-1.amazonaws.com/prod-v2';

        function AdminDashboard() {
            const [activeTab, setActiveTab] = useState('overview');
            const [tenants, setTenants] = useState([]);
            const [conversations, setConversations] = useState([]);
            const [products, setProducts] = useState([]);
            const [selectedTenant, setSelectedTenant] = useState(null);
            const [showProductModal, setShowProductModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [statusFilter, setStatusFilter] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [loading, setLoading] = useState(false);
            const [notification, setNotification] = useState(null);

            useEffect(() => {
                fetchTenants();
                setConversations([
                    { id: '1', tenant: 'AI Tech Solutions', customer: '+1234567890', status: 'active', lastMessage: '2 minutes ago' },
                    { id: '2', tenant: 'Digital Marketing Pro', customer: '+1987654321', status: 'escalated', lastMessage: '5 minutes ago' },
                    { id: '3', tenant: 'E-commerce Solutions', customer: '+1122334455', status: 'resolved', lastMessage: '10 minutes ago' }
                ]);
            }, []);

            useEffect(() => {
                if (selectedTenant) {
                    fetchProducts(selectedTenant.id);
                }
            }, [selectedTenant]);

            const fetchTenants = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/tenants`);
                    if (response.ok) {
                        const data = await response.json();
                        const formattedTenants = data.map(item => ({
                            id: item.tenantId,
                            name: item.businessName || 'Unnamed Business',
                            status: item.status || 'unknown',
                            conversations: 0
                        }));
                        setTenants(formattedTenants);
                        if (formattedTenants.length > 0 && !selectedTenant) {
                            setSelectedTenant(formattedTenants[0]);
                        }
                    }
                } catch (error) {
                    console.error('Error fetching tenants:', error);
                }
            };

            const fetchProducts = async (tenantId) => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/products?tenantId=${tenantId}`);
                    if (response.ok) {
                        const data = await response.json();
                        setProducts(data);
                    } else {
                        setProducts([]);
                    }
                } catch (error) {
                    console.error('Error fetching products:', error);
                    setProducts([]);
                } finally {
                    setLoading(false);
                }
            };

            const createProduct = async (productData) => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/products`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...productData, tenantId: selectedTenant.id })
                    });
                    if (response.ok) {
                        showNotification('Product created successfully', 'success');
                        fetchProducts(selectedTenant.id);
                        setShowProductModal(false);
                    } else {
                        showNotification('Failed to create product', 'error');
                    }
                } catch (error) {
                    showNotification('Error creating product', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const updateProduct = async (productId, productData) => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/products/${productId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...productData, tenantId: selectedTenant.id })
                    });
                    if (response.ok) {
                        showNotification('Product updated successfully', 'success');
                        fetchProducts(selectedTenant.id);
                        setShowProductModal(false);
                        setEditingProduct(null);
                    } else {
                        showNotification('Failed to update product', 'error');
                    }
                } catch (error) {
                    showNotification('Error updating product', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const deleteProduct = async (productId) => {
                if (!confirm('Are you sure you want to delete this product?')) return;

                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/products/${productId}?tenantId=${selectedTenant.id}`, {
                        method: 'DELETE'
                    });
                    if (response.ok || response.status === 204) {
                        showNotification('Product deleted successfully', 'success');
                        fetchProducts(selectedTenant.id);
                    } else {
                        showNotification('Failed to delete product', 'error');
                    }
                } catch (error) {
                    showNotification('Error deleting product', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const showNotification = (message, type) => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const filteredProducts = products.filter(product => {
                const matchesStatus = statusFilter === 'all' || product.status === statusFilter;
                const matchesSearch = !searchQuery ||
                    product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    product.description?.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesStatus && matchesSearch;
            });

            const TabButton = ({ id, label, isActive, onClick }) => (
                <button
                    onClick={() => onClick(id)}
                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${isActive
                        ? 'bg-blue-600 text-white'
                        : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                >
                    {label}
                </button>
            );

            const ProductModal = () => {
                const [formData, setFormData] = useState(editingProduct || {
                    name: '',
                    price: '',
                    condition: '',
                    description: '',
                    category: '',
                    status: 'available'
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (editingProduct) {
                        updateProduct(editingProduct.productId, formData);
                    } else {
                        createProduct(formData);
                    }
                };

                if (!showProductModal) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium mb-4">{editingProduct ? 'Edit Product' : 'Add Product'}</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
                                    <input
                                        type="text"
                                        required
                                        value={formData.name}
                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        placeholder="e.g., iPhone 16 Pro Max"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Price ($) *</label>
                                    <input
                                        type="number"
                                        required
                                        value={formData.price}
                                        onChange={(e) => setFormData({ ...formData, price: parseFloat(e.target.value) })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        placeholder="1200"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Condition *</label>
                                    <select
                                        required
                                        value={formData.condition}
                                        onChange={(e) => setFormData({ ...formData, condition: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                    >
                                        <option value="">Select Condition</option>
                                        <option value="new">New</option>
                                        <option value="used">Used</option>
                                        <option value="damaged">Damaged</option>
                                        <option value="refurbished">Refurbished</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea
                                        value={formData.description}
                                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        rows="3"
                                        placeholder="Product details..."
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                    <input
                                        type="text"
                                        value={formData.category}
                                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        placeholder="e.g., Electronics"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                    <select
                                        value={formData.status}
                                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                    >
                                        <option value="available">Available</option>
                                        <option value="reserved">Reserved</option>
                                        <option value="sold">Sold</option>
                                    </select>
                                </div>
                                <div className="flex space-x-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setShowProductModal(false);
                                            setEditingProduct(null);
                                        }}
                                        className="flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
                                    >
                                        {loading ? 'Saving...' : 'Save Product'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const ProductsTab = () => (
                <div className="space-y-4">
                    <div className="bg-white rounded-lg shadow p-4">
                        <div className="flex justify-between items-center mb-4">
                            <div>
                                <h2 className="text-lg font-medium text-gray-900">Product Management</h2>
                                <p className="text-sm text-gray-500">
                                    Tenant: {selectedTenant?.name}
                                </p>
                            </div>
                            <button
                                onClick={() => {
                                    setEditingProduct(null);
                                    setShowProductModal(true);
                                }}
                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                            >
                                + Add Product
                            </button>
                        </div>

                        <div className="flex space-x-4 mb-4">
                            <select
                                value={statusFilter}
                                onChange={(e) => setStatusFilter(e.target.value)}
                                className="px-3 py-2 border border-gray-300 rounded-md"
                            >
                                <option value="all">All Products</option>
                                <option value="available">Available</option>
                                <option value="sold">Sold</option>
                                <option value="reserved">Reserved</option>
                            </select>
                            <input
                                type="search"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                placeholder="Search products..."
                                className="flex-1 px-3 py-2 border border-gray-300 rounded-md"
                            />
                        </div>

                        {loading ? (
                            <div className="text-center py-8 text-gray-500">Loading products...</div>
                        ) : filteredProducts.length === 0 ? (
                            <div className="text-center py-8 text-gray-500">
                                {products.length === 0 ? 'No products yet. Click "Add Product" to get started.' : 'No products match your filters.'}
                            </div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Price</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Condition</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {filteredProducts.map(product => (
                                            <tr key={product.productId}>
                                                <td className="px-6 py-4">
                                                    <div className="text-sm font-medium text-gray-900">{product.name}</div>
                                                    {product.description && (
                                                        <div className="text-sm text-gray-500 truncate max-w-xs">{product.description}</div>
                                                    )}
                                                </td>
                                                <td className="px-6 py-4 text-sm text-gray-900">${product.price?.toLocaleString()}</td>
                                                <td className="px-6 py-4">
                                                    <span className="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800 capitalize">
                                                        {product.condition}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full capitalize ${product.status === 'available' ? 'bg-green-100 text-green-800' :
                                                            product.status === 'sold' ? 'bg-red-100 text-red-800' :
                                                                'bg-yellow-100 text-yellow-800'
                                                        }`}>
                                                        {product.status}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 text-sm text-gray-900">{product.category || '-'}</td>
                                                <td className="px-6 py-4 text-sm font-medium space-x-2">
                                                    <button
                                                        onClick={() => {
                                                            setEditingProduct(product);
                                                            setShowProductModal(true);
                                                        }}
                                                        className="text-blue-600 hover:text-blue-900"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => deleteProduct(product.productId)}
                                                        className="text-red-600 hover:text-red-900"
                                                    >
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );

            // Keep existing tabs (OverviewTab, TenantsTab, ConversationsTab) from original file
            const OverviewTab = () => (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div className="bg-white p-6 rounded-lg shadow">
                            <h3 className="text-sm font-medium text-gray-500">Total Tenants</h3>
                            <p className="text-2xl font-bold text-gray-900">{tenants.length}</p>
                        </div>
                        <div className="bg-white p-6 rounded-lg shadow">
                            <h3 className="text-sm font-medium text-gray-500">Active Conversations</h3>
                            <p className="text-2xl font-bold text-gray-900">{conversations.filter(c => c.status === 'active').length}</p>
                        </div>
                        <div className="bg-white p-6 rounded-lg shadow">
                            <h3 className="text-sm font-medium text-gray-500">Escalated</h3>
                            <p className="text-2xl font-bold text-orange-600">{conversations.filter(c => c.status === 'escalated').length}</p>
                        </div>
                        <div className="bg-white p-6 rounded-lg shadow">
                            <h3 className="text-sm font-medium text-gray-500">Resolved Today</h3>
                            <p className="text-2xl font-bold text-green-600">{conversations.filter(c => c.status === 'resolved').length}</p>
                        </div>
                    </div>
                </div>
            );

            const TenantsTab = () => (
                <div className="bg-white rounded-lg shadow">
                    <div className="px-6 py-4 border-b border-gray-200">
                        <h2 className="text-lg font-medium text-gray-900">Tenant Management</h2>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tenant</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conversations</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {tenants.map(tenant => (
                                    <tr key={tenant.id}>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <div>
                                                <div className="text-sm font-medium text-gray-900">{tenant.name}</div>
                                                <div className="text-sm text-gray-500">{tenant.id}</div>
                                            </div>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                {tenant.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {tenant.conversations}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button
                                                onClick={() => {
                                                    setSelectedTenant(tenant);
                                                    setActiveTab('products');
                                                }}
                                                className="text-blue-600 hover:text-blue-900 mr-4"
                                            >
                                                View Products
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            const ConversationsTab = () => (
                <div className="bg-white rounded-lg shadow">
                    <div className="px-6 py-4 border-b border-gray-200">
                        <h2 className="text-lg font-medium text-gray-900">Active Conversations</h2>
                    </div>
                    <div className="p-6">
                        <div className="space-y-4">
                            {conversations.map(conv => (
                                <div key={conv.id} className="border border-gray-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between mb-2">
                                        <h3 className="font-medium text-gray-900">{conv.tenant}</h3>
                                        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${conv.status === 'active' ? 'bg-green-100 text-green-800' :
                                            conv.status === 'escalated' ? 'bg-orange-100 text-orange-800' :
                                                'bg-gray-100 text-gray-800'
                                            }`}>
                                            {conv.status}
                                        </span>
                                    </div>
                                    <p className="text-sm text-gray-600">Customer: {conv.customer}</p>
                                    <p className="text-sm text-gray-500">Last activity: {conv.lastMessage}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-100">
                    {notification && (
                        <div className={`fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'
                            } text-white`}>
                            {notification.message}
                        </div>
                    )}

                    <header className="bg-white shadow">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <h1 className="text-3xl font-bold text-gray-900">AI Marketplace Assistant</h1>
                                <div className="text-sm text-gray-500">Admin Dashboard</div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                        <div className="px-4 py-6 sm:px-0">
                            <div className="mb-6">
                                <nav className="flex space-x-4">
                                    <TabButton
                                        id="overview"
                                        label="Overview"
                                        isActive={activeTab === 'overview'}
                                        onClick={setActiveTab}
                                    />
                                    <TabButton
                                        id="tenants"
                                        label="Tenants"
                                        isActive={activeTab === 'tenants'}
                                        onClick={setActiveTab}
                                    />
                                    <TabButton
                                        id="products"
                                        label="Products"
                                        isActive={activeTab === 'products'}
                                        onClick={setActiveTab}
                                    />
                                    <TabButton
                                        id="conversations"
                                        label="Conversations"
                                        isActive={activeTab === 'conversations'}
                                        onClick={setActiveTab}
                                    />
                                </nav>
                            </div>

                            <div>
                                {activeTab === 'overview' && <OverviewTab />}
                                {activeTab === 'tenants' && <TenantsTab />}
                                {activeTab === 'products' && <ProductsTab />}
                                {activeTab === 'conversations' && <ConversationsTab />}
                            </div>
                        </div>
                    </main>

                    <ProductModal />
                </div>
            );
        }

        ReactDOM.render(<AdminDashboard />, document.getElementById('root'));
    </script>
</body>

</html>